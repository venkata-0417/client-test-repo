<div class="header pb-6">
    <div class="container-fluid">
        <div class="header-body">
            <div class="row align-items-center py-4">
                <div class="col-lg-6 col-7">
                    <h2 class="mb-0" style="color: #ffffff; font-family: 'Auxilia bold';">Source Code Download</h2>
                </div>
                <div class="col-lg-6 col-5 d-flex justify-content-end">
                    <button type="button" class="btn success" pTooltip="Back" tooltipPosition="top" (click)="onBack()">
                        <i class="fa fa-arrow-left fa-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<form [formGroup]="downloadForm">
    <div class="container-fluid mt--6">
        <div class="row">
            <div class="col">
                <div class="card shadow" style="border-radius: 7px;">
                    <!-- Card Header -->
                    <div class="card-header" style="border-top-left-radius: 7px; border-top-right-radius: 7px;">
                        <div class="row align-items-center">
                            <div class="col">
                                <h3 class="mb-0" style="color: #02425c; font-family: 'Auxilia bold';">
                                    <i class="fas fa-download mr-2"></i>Download Source Code
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- Card Body -->
                    <div class="card-body" style="padding: 2rem;">
                        <!-- Loading Spinner -->
                        <div *ngIf="isLoading" class="text-center py-5">
                            <div class="spinner-border" style="color: #0A424A;" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <p class="mt-3 text-gray">Loading data...</p>
                        </div>

                        <!-- Main Content -->
                        <div *ngIf="!isLoading">
                            <!-- Project Information Card -->
                            <div class="info-card mb-4" *ngIf="projectDetails">
                                <div class="info-card-header">
                                    <h5 style="color: #02425c; font-family: 'Auxilia bold'; margin-bottom: 0;">
                                        <i class="fas fa-project-diagram mr-2"></i>Project Information
                                    </h5>
                                </div>
                                <div class="info-card-body">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="info-item">
                                                <label class="info-label">Project Name</label>
                                                <div class="info-value">{{ projectDetails.ProjectName || 'N/A' }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="info-item">
                                                <label class="info-label">Upload Type</label>
                                                <div class="info-value">{{ projectDetails.UploadType || 'N/A' }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="info-item">
                                                <label class="info-label">Project Status</label>
                                                <div class="info-value">
                                                    <span class="status-badge">{{ projectDetails.Project_Status || 'Active'
                                                        }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="info-item">
                                                <label class="info-label">Total Versions</label>
                                                <div class="info-value">
                                                    <span class="version-count">{{ versionList.length }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Version Selection Section -->
                            <div class="selection-section mb-4">
                                <h5 class="section-title">
                                    <i class="fas fa-code-branch mr-2"></i>Select Version to Download
                                </h5>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-control-label" for="Version"
                                                style="color: #02425c; font-family: 'Auxilia bold';">
                                                Version <span style="color: red;">*</span>
                                            </label>
                                            <select name="Version" id="Version" class="form-control"
                                                formControlName="Version" (change)="onVersionChange($event)"
                                                style="border: 0.5px solid #000; border-radius: 5px;"
                                                [ngClass]="{'is-invalid': f.Version.touched && f.Version.invalid}">
                                                <option value="">-- Select Version --</option>
                                                <option *ngFor="let version of versionList" [value]="version.Id">
                                                    Version {{ version.Version }} - {{ version.CodeLastPullAt }}
                                                </option>
                                            </select>
                                            <div *ngIf="f.Version.touched && f.Version.invalid"
                                                class="errorMsg-feedback">
                                                Please select a version
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Selected Version Details -->
                                    <div class="col-md-6" *ngIf="selectedVersion">
                                        <div class="selected-version-box">
                                            <h6 class="mb-3" style="color: #02425c; font-family: 'Auxilia bold';">
                                                <i class="fas fa-info-circle mr-2"></i>Selected Version Details
                                            </h6>
                                            <div class="detail-row">
                                                <span class="detail-label">Version:</span>
                                                <span class="detail-value">{{ selectedVersion.Version }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Created By:</span>
                                                <span class="detail-value">{{ selectedVersion.CodePull_by || 'N/A'
                                                    }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Created Date:</span>
                                                <span class="detail-value">{{ selectedVersion.CodeLastPullAt  }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Instructions Section -->
                            <div class="instructions-section mb-4">
                                <h5 class="section-title" style="color: #f2a123;">
                                    <i class="fas fa-exclamation-circle mr-2"></i>Download Instructions
                                </h5>
                                <ul class="instruction-list">
                                    <li>Select the version you want to download from the dropdown above</li>
                                    <li>Click the "Download Source Code" button to start the download</li>
                                    <li>The source code will be downloaded as a ZIP file</li>
                                    <li>Extract the ZIP file to access the source code files</li>
                                    <li>Ensure you have proper authorization to download and access the source code</li>
                                </ul>
                            </div>

                            <!-- Action Buttons -->
                            <div class="text-center py-3">
                                <button type="button" class="btn btn-lg successbtn px-5" (click)="downloadSourceCode()"
                                    [disabled]="downloadForm.invalid || isLoading">
                                    <i class="fas fa-download mr-2"></i>
                                    Download Source Code
                                </button>
                                <button type="button" class="btn btn-lg dangerbtn ml-3 px-5" (click)="onBack()">
                                    <i class="fas fa-times mr-2"></i>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Card Footer with Stats -->
                    <div class="card-footer"
                        style="background-color: #C9F5D9; border-bottom-left-radius: 7px; border-bottom-right-radius: 7px;">
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="stat-wrapper">
                                    <i class="fas fa-code-branch fa-2x mb-2" style="color: #0A424A;"></i>
                                    <h4 class="mb-0" style="color: #02425c; font-family: 'Auxilia bold';">{{
                                        versionList.length }}</h4>
                                    <small class="text-gray" style="font-family: 'Auxilia bold';">Available
                                        Versions</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-wrapper">
                                    <i class="fas fa-file-archive fa-2x mb-2" style="color: #0A424A;"></i>
                                    <h4 class="mb-0" style="color: #02425c; font-family: 'Auxilia bold';">ZIP</h4>
                                    <small class="text-gray" style="font-family: 'Auxilia bold';">Download
                                        Format</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-wrapper">
                                    <i class="fas fa-shield-alt fa-2x mb-2" style="color: #0A424A;"></i>
                                    <h4 class="mb-0" style="color: #02425c; font-family: 'Auxilia bold';">Secure</h4>
                                    <small class="text-gray" style="font-family: 'Auxilia bold';">Encrypted
                                        Transfer</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<p-toast position="top-right" [showTransformOptions]="'translateY(100%)'" [showTransitionOptions]="'1000ms'"
    [hideTransitionOptions]="'1000ms'">
</p-toast>